@model IEnumerable<CharityProject.Models.Transaction>

@{
    Layout = "_Layout_Employees";
    ViewData["PageTitle"] = "المعاملات";
    ViewData["Title"] = "صفحة المعاملات";
    var permission = Context.Session.GetString("Permission_position");
    if (Context.Session.GetString("Permission_position") == "مدير الموارد البشرية والمالية")
    {
        Layout = "_Layout_HR";

    }
    else if (Context.Session.GetString("Permission_position") == "مدير خدمة المستفيدين" || Context.Session.GetString("Permission_position") == "مدير التنمية المالية والاستدامة")
    {
        Layout = "_Layout_Managers";
    }
    else if (Context.Session.GetString("Permission_position") == "موظف" || Context.Session.GetString("Permission_position") == "السكرتير")
    {
        Layout = "_Layout_Employees";
    }
    else
    {
        Layout = "_Layout";
    }
}

<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>@ViewData["PageTitle"]</title>
    <link rel="stylesheet" href="~/css/site.css">
    <style>
        .arrow-down {
            cursor: pointer;
        }

        .dropdown-menu {
            display: none;
            position: absolute;
            left: 0;
            top: 100%;
            z-index: 10;
        }

        .active-tab {
            border-bottom: 2px solid green; /* Example of green line */
       
        }




    </style>
</head>
<body>
    <!-- Tab and search UI -->
    <div class="flex justify-between mt-10">

        <!-- Right Side: Dropdown Button -->
        <div class="flex items-center">
            <button id="dropdownDefaultButton" data-dropdown-toggle="dropdown" class="text-white w-32 bg-primaryButtons hover:bg-emerald-800 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-xl px-4 py-2.5 text-center inline-flex justify-evenly items-center transition duration-200 ease-in-out">
                جديد
                <svg class="w-2.5 h-2.5 mx-1 mt-1" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 10 6">
                    <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 1 4 4 4-4" />
                </svg>
            </button>

            <!-- Dropdown menu -->
            <div id="dropdown" class="z-10 hidden bg-white divide-y divide-gray-100 rounded-lg shadow dark:bg-gray-700">
                <ul class="py-2 text-base text-black dark:text-gray-200" aria-labelledby="dropdownDefaultButton">
                    <li>
                        <button data-toggle="modal" data-target="#insertTransactionModal" id="modal-toggle-button" class="block px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-600 dark:hover:text-white">داخلية</button>
                    </li>
                    <li>
                        <button data-toggle="modal" data-target="#insertHolidayModal" id="modal-toggle-button" class="block px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-600 dark:hover:text-white">إجازة</button>
                    </li>
                    <li>
                        <button type="button" data-toggle="modal" data-target="#insertLetterModal" id="modal-toggle-button" class="block px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-600 dark:hover:text-white">خطاب</button>
                    </li>
                    <li>
                        <button type="button" data-toggle="modal" data-target="#insertChartersModal" id="modal-toggle-button" class="block px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-600 dark:hover:text-white">عهدة</button>
                    </li>
                </ul>
            </div>
        </div>
        <!-- Left Side: Search Form -->
        <div class="flex items-center space-x-2">
            <div class="flex items-center">
                <input id="transactionSearch" placeholder="عنوان او رقم المعاملة" class="form-control mr-2" type="search" aria-label="search" />
                <button id="searchButton" class="btn btn-dark" type="button">بحث</button>
                <select id="sortOrder" class="bg-white border border-primaryButtons px-5 text-black text-sm py-2 rounded-lg text-center focus:ring-blue-500 focus:border-blue-500 block mr-2">
                    <option value="newest">الاحدث</option>
                    <option value="oldest">الاقدم</option>
                </select>
            </div>
        </div>
    </div>

    <div class="mb-4 border-b border-gray-200 dark:border-gray-700">
        <ul class="flex flex-wrap -mb-px text-xl font-medium text-center" id="default-tab" role="tablist">
            <li class="me-2 flex items-center" role="presentation">
                <button class="inline-block p-4 border-b-2 rounded-t-lg active-tab" id="internal-tab" data-content-url="@Url.Action("GetAllTransactions", "HR")" type="button" role="tab">داخلية </button>
                <span class="text-red-500 text-sm ml-2">(@ViewBag.InternalCount)</span>
            </li>
            <li class="me-2 flex items-center relative" role="presentation">
                <button class="inline-block p-4 border-b-2 rounded-t-lg" id="holidays-tab" data-content-url="@Url.Action("GetAllHolidays", "HR")" type="button" role="tab">
                    إجازات
                </button>
                <span class="text-red-500 text-sm ml-2">(@ViewBag.HolidaysCount)</span>
                <svg class="w-4 h-4 ml-2 cursor-pointer arrow-down" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" />
                </svg>
                <!-- Dropdown menu -->
                <ul class="absolute left-0 mt-2 hidden w-32 bg-white border border-gray-200 rounded-lg shadow-lg dropdown-menu">
                    <li><a href="#" id="sec1" class="block px-4 py-2 text-black hover:bg-gray-100" data-content-url="@Url.Action("GetRejectedHolidays", "HR")">اجازات رفضت</a></li>
                    <li><a href="#" id="sec2" class="block px-4 py-2 text-black hover:bg-gray-100" data-content-url="@Url.Action("GetAllHolidays", "HR")">اجازات مرسلة</a></li>
                </ul>


            </li>



            <li class="me-2 flex items-center" role="presentation">
                <button class="inline-block p-4 border-b-2 rounded-t-lg" id="letters-tab" data-content-url="@Url.Action("GetAllLetters", "HR")" type="button" role="tab">خطابات</button>
                <span class="text-red-500 text-sm ml-2">(@ViewBag.LettersCount)</span>
            </li>
            <li class="flex items-center" role="presentation">
                <button class="inline-block p-4 border-b-2 rounded-t-lg" id="charters-tab" data-content-url="@Url.Action("GetAllCharters", "HR")" type="button" role="tab">عهده</button>
                <span class="text-red-500 text-sm ml-2">(@ViewBag.AssetsCount)</span>
            </li>
        </ul>
    </div>

    <!-- Tab content -->
    <div id="tab-content-container" class="">
        <!-- Content will be dynamically loaded here -->
    </div>

    @await Html.PartialAsync("_CreateNewTransaction", new Transaction())
    @await Html.PartialAsync("_Create_Letter", new letter())
    @await Html.PartialAsync("_Create_Holiday", new HolidayHistory())
    @await Html.PartialAsync("Create_Charter", new charter())

    <script src="~/js/site.js"></script>
    <script>
        const placeholders = {
            internal: "عنوان او رقم المعاملة",
            holidays: "رقم الإجازة",
            external: "رقم الهوية او رقم الصادر",
            letters: "عنوان او رقم الخطاب",
            charters: "رقم العهده"
        };
        $(document).ready(function () {
            let selectedTab = 'internal'; // Default tab type

            function loadTabContent(url, searchTerm, sortOrder) {
                $("#tab-content-container").html('<div class="text-center"><div class="spinner text-center"></div><p>جاري تحميل المحتوى...</p></div>');
                $.ajax({
                    url: url,
                    type: 'GET',
                    data: { searchTerm: searchTerm, sortOrder: sortOrder },
                    success: function (result) {
                        $("#tab-content-container").html(result);
                    },
                    error: function (xhr, status, error) {
                        console.error(`Error loading content from ${url}: ${error}`);
                        $("#tab-content-container").html('<p class="text-center">فشل تحميل المحتوى. حاول مرة أخرى لاحقاً.</p>');
                    }
                });
            }


            // Handle tab clicks
            $("#default-tab button").on("click", function () {
                selectedTab = $(this).attr('id').replace('-tab', ''); // Update selectedTab with the clicked tab id
                var url = $(this).data("content-url");
                loadTabContent(url, $('#transactionSearch').val(), $('#sortOrder').val());

                // Remove active-tab from other tabs and add it to the clicked tab
                $("#default-tab button").removeClass("active-tab");
                $(this).addClass("active-tab");

                // Update the placeholder text based on selected tab
                $('#transactionSearch').attr('placeholder', placeholders[selectedTab]);
            });


            // Load initial tab content
            $("#internal-tab").trigger("click");

            // Handle search input typing
            $('#transactionSearch').on('keyup', function () {
                var searchTerm = $(this).val().toLowerCase();
                var items = $('#tab-content-container li').filter(function () {
                    var text = $(this).text().toLowerCase();
                    return text.indexOf(searchTerm) > -1;
                });

                $('#tab-content-container li').each(function () {
                    $(this).toggle(items.index($(this)) > -1);
                });
            });

            $('#sortOrder').on('change', function () {
                var sortOrder = $(this).val();

                var items = $('#tab-content-container ul > li').detach(); // Detach `li` elements

                // Sort items based on the selected order
                items.sort(function (a, b) {
                    var firstItem = $(a).text().trim();
                    var secondItem = $(b).text().trim();

                    if (sortOrder === 'newest') {
                        return firstItem > secondItem ? -1 : 1; // Sort descending
                    } else if (sortOrder === 'oldest') {
                        return firstItem < secondItem ? -1 : 1; // Sort ascending
                    }
                    return 0; // No sorting by default
                });
<<<<<<< HEAD
                $('#tab-content-container').html('').append(items);
            });

            // Handle dropdown arrow click to toggle visibility
            $('.arrow-down').on('click', function (event) {
                event.stopPropagation(); // Prevent the click from triggering the tab functionality
                $(this).siblings('.dropdown-menu').toggle(); // Toggle the dropdown visibility
            });

            // Close the dropdown when clicking outside
            $(document).on('click', function () {
                $('.dropdown-menu').hide(); // Hide the dropdown when clicking outside
            });

            // Prevent closing the dropdown when clicking inside it
            $('.dropdown-menu').on('click', function (event) {
                event.stopPropagation(); // Prevent the click from closing the dropdown
            });

            // Load holidays for sec1 (rejected holidays)
            $('#sec1').on('click', function (event) {
                event.preventDefault();
                loadHolidays('@Url.Action("GetRejectedHolidays", "HR")', 'rejected');  // Load rejected holidays
            });

            // Load holidays for sec2 (all holidays)
            $('#sec2').on('click', function (event) {
                event.preventDefault();
                loadHolidays('@Url.Action("GetAllHolidays", "HR")', 'all');  // Load all holidays (similar to إجازات)
            });

            // Function to load holidays based on URL and type
            function loadHolidays(url, type) {
                $.ajax({
                    url: url,
                    type: 'GET',
                    dataType: 'html', // Expect HTML content for better dynamic content rendering
                    success: function (data) {
                        // Clear the current content and append the new results directly into the #tab-content-container
                        $('#tab-content-container').html(data);
                    },
                    error: function () {
                        alert('Error loading holidays.');
                    }
                });
            }
=======

                // Re-append sorted items to the `<ul>`
                var container = $('#tab-content-container ul');
                $.each(items, function (i, li) {
                    container.append(li); // Add sorted items
                });
            });



>>>>>>> 269526e123b6c271f040cb185de0229ea996193e
        });

    </script>



</body>
</html>
