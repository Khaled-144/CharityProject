@model IEnumerable<CharityProject.Models.letter>

<div class="p-2 rounded-lg shadow" style="max-height: 750px; overflow-y: auto;">
    <ul class="w-full divide-y divide-gray-200 dark:divide-gray-700">
        @foreach (var item in Model)
        {
            <li class="mb-2 shadow-sm bg-white">
                <div class="flex items-center space-x-4 rtl:space-x-reverse text-center">
                    <!-- Letter ID -->
                    <div class="flex-shrink-0 border-2 m-2 ml-3 p-3">
                        <p class="text-blue-600">
                            #@Html.DisplayFor(modelItem => item.letters_id)
                        </p>
                    </div>

                    <!-- Letter Information -->
                    <div class="flex-1 min-w-0 text-xl text-right">
                        <div class="flex">
                            <p class="font-medium text-gray-900 truncate dark:text-white px-2">
                                @Html.DisplayFor(modelItem => item.title)
                            </p>
                            <p class="font-medium text-gray-900 truncate dark:text-white" dir="ltr">
                              @(item.date.ToString("yyyy-MM-dd") ?? "1/1/1000")  |
                            </p>
                        </div>

                        <p class="text-gray-500 truncate dark:text-gray-400">
                            @Html.DisplayFor(modelItem => item.description)
                        </p>

                        <!-- Confidentiality, Urgency, Importance, and Employee Name -->
                        <div class="flex space-x-4 rtl:space-x-reverse w-fit mb-1">

                            <!-- Employee Name (بواسطة) -->
                            @if (ViewBag.EmployeeNames != null)
                            {
                                <p class="text-base ml-4">
                                    بواسطة:
                                    @{
                                        string fromName;
                                        var employeeNames = ViewBag.EmployeeNames as Dictionary<int, string>;
                                        if (employeeNames != null && employeeNames.TryGetValue(item.from_emp_id, out fromName))
                                        {
                                            @fromName
                                        }
                                        else
                                        {
                                            <text>Unknown Employee (ID: @item.from_emp_id)</text>
                                        }
                                    }
                                </p>
                            }

                            <!-- Confidentiality -->
                            @if (item.Confidentiality != "غير سري" && item.Confidentiality != null)
                            {
                                <div class="flex items-center p-1 bg-gray-100 rounded-md text-sm">
                                    <i class="fas fa-lock text-xs ml-1"></i>
                                    <span class="text-gray-700">
                                        @if (item.Confidentiality == "سري")
                                        {
                                            <text>سري</text>
                                        }
                                        else
                                        {
                                            <text>غير سري</text>
                                        }
                                    </span>
                                </div>
                            }

                            <!-- Urgency -->
                            @if (item.Urgency != "غير عاجل" && item.Urgency != null)
                            {
                                <div class="flex items-center p-1 bg-gray-100 rounded-md text-sm">
                                    <i class="fas fa-clock text-green-500 text-xs ml-1"></i>
                                    <span class="text-gray-700">
                                        @if (item.Urgency == "حالاً")
                                        {
                                            <text>حالاً</text>
                                        }
                                        else if (item.Urgency == "عاجل")
                                        {
                                            <text>عاجل</text>
                                        }
                                        else
                                        {
                                            <text>غير عاجل</text>
                                        }
                                    </span>
                                </div>
                            }

                            <!-- Importance -->
                            @if (item.Importance != "عادي" && item.Importance != null)
                            {
                                <div class="flex items-center p-1 bg-gray-100 rounded-md text-sm">
                                    <i class="fas fa-exclamation-circle text-red-500 text-xs ml-1"></i>
                                    <span class="text-gray-700">
                                        @if (item.Importance == "هام")
                                        {
                                            <text>هام</text>
                                        }
                                        else
                                        {
                                            <text>عادي</text>
                                        }
                                    </span>
                                </div>
                            }
                        </div>
                    </div>

                    <!-- View Button -->
                    <div class="inline-flex items-center ml-3">
                        <button type="button" class="btn btn-dark" data-toggle="modal" data-target="@("#detailModal-" + item.letters_id)">
                            عرض
                        </button>
                        @await Html.PartialAsync("_ShowLetterDetail", item)
                    </div>
                </div>
            </li>
        }
    </ul>
</div>