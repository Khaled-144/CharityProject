@model IEnumerable<CharityProject.Models.Transaction>

@{
   
    Layout = "_Layout_Managers";
    ViewData["PageTitle"] = "الارشيف";
    ViewData["Title"] = "صفحة الارشيف";
    var currentUrl = $"{Context.Request.Scheme}://{Context.Request.Host}{Context.Request.Path}{Context.Request.QueryString}";
    ViewBag.CurrentUrl = currentUrl;
}

<!DOCTYPE html>
<html lang="ar">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>@ViewData["PageTitle"]</title>
    <link rel="stylesheet" href="~/css/site.css">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">

    <!-- Add any additional CSS or JS references here -->
    <style>
        .active-tab {
            border-color: #248277;
            color: #248277;
        }
    </style>
</head>

<body>
    <div class="flex justify-end mt-10">
        <div class="flex items-center space-x-2">
            <input id="transactionSearch" placeholder="عنوان او رقم المعاملة" class="form-control mr-2" type="search" aria-label="search" />
            <button id="searchButton" class="btn btn-dark" type="button">بحث</button>
            <select id="sortOrder" class="bg-white border border-primaryButtons px-5 text-black text-sm py-2 rounded-lg text-center focus:ring-blue-500 focus:border-blue-500">
                <option value="newest">الاحدث</option>
                <option value="oldest">الاقدم</option>
            </select>
        </div>
    </div>



    <!-- Tab navigation -->
    <div class="mb-4 border-b border-gray-200 dark:border-gray-700">
        <ul class="flex flex-wrap -mb-px text-xl font-medium text-center" id="default-tab" role="tablist">
            <li class="me-2 flex items-center relative" role="presentation">
                <button class="inline-block p-4 border-b-2 rounded-t-lg active-tab" id="internal-tab"
                        data-content-url="@Url.Action("GetAllTransactionsArchived", "CEO")" type="button" role="tab">
                    داخلية
                </button>
                <svg class="w-4 h-4 ml-2 cursor-pointer arrow-down" xmlns="http://www.w3.org/2000/svg" fill="none"
                     viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" />
                </svg>
                <!-- Dropdown menu for transactions -->
                <ul class="absolute left-0 mt-2 hidden w-32 bg-white border border-gray-200 text-right rounded-lg shadow-lg dropdown-menu">
                    <li>
                        <a href="#" id="transactions-all" class="block px-4 py-2 text-black hover:bg-gray-100"
                           data-content-url="@Url.Action("GetAllEmployeesTransactionsArchived", "CEO")">
                            جميع المعاملات
                        </a>
                    </li>
                </ul>
            </li>

            <li class="me-2 flex items-center relative" role="presentation">
                <button class="inline-block p-4 border-b-2 rounded-t-lg" id="holidays-tab"
                        data-content-url="@Url.Action("GetMyHolidays", "CEO")" type="button" role="tab">
                    إجازاتي
                </button>
                <svg class="w-4 h-4 ml-2 cursor-pointer arrow-down" xmlns="http://www.w3.org/2000/svg" fill="none"
                     viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" />
                </svg>
                <!-- Dropdown menu for holidays -->
                <ul class="absolute left-0 mt-2 hidden w-32 bg-white border border-gray-200 text-right rounded-lg shadow-lg dropdown-menu">
                    <li>
                        <a href="#" id="holidays-all" class="block px-4 py-2 text-black hover:bg-gray-100"
                           data-content-url="@Url.Action("GetAllHolidaysArchive", "CEO")">
                            جميع الإجازات
                        </a>
                    </li>
                </ul>
            </li>

            <li class="me-2 flex items-center relative" role="presentation">
                <button class="inline-block p-4 border-b-2 rounded-t-lg" id="letters-tab"
                        data-content-url="@Url.Action("GetAllMyLetters", "CEO")" type="button" role="tab">
                    خطاباتي
                </button>
                <svg class="w-4 h-4 ml-2 cursor-pointer arrow-down" xmlns="http://www.w3.org/2000/svg" fill="none"
                     viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" />
                </svg>
                <!-- Dropdown menu for letters -->
                <ul class="absolute left-0 mt-2 hidden w-32 bg-white border border-gray-200 text-right rounded-lg shadow-lg dropdown-menu">
                    <li>
                        <a href="#" id="letters-all" class="block px-4 py-2 text-black hover:bg-gray-100"
                           data-content-url="@Url.Action("GetAllLettersArchived", "CEO")">
                            جميع الخطابات
                        </a>
                    </li>
                </ul>
            </li>

            <li class="flex items-center" role="presentation">
                <button class="inline-block p-4 border-b-2 rounded-t-lg" id="charters-tab" data-content-url="@Url.Action("GetAllChartersArchived", "CEO")" type="button" role="tab">عهده</button>
            </li>
        </ul>
    </div>

    <!-- Tab content -->
    <div id="tab-content-container" class="">
        <!-- Content will be dynamically loaded here -->
    </div>


    <script src="~/js/site.js"></script>
    <script>
        $(document).ready(function () {
            const placeholders = {
                internal: "عنوان او رقم المعاملة",
                holidays: "رقم الإجازة",
                external: "رقم الهوية او رقم الصادر",
                letters: "عنوان او رقم الخطاب",
                charters: "رقم العهده"
            };

            let selectedTab = 'internal'; // Default selected tab

            function loadTabContent(url, searchTerm, sortOrder) {
                $("#tab-content-container").html('<div class="text-center"><div class="spinner text-center"></div><p>جاري تحميل المحتوى...</p></div>');
                $.ajax({
                    url: url,
                    type: 'GET',
                    data: { searchTerm: searchTerm, sortOrder: sortOrder },
                    success: function (result) {
                        $("#tab-content-container").html(result);
                    },
                    error: function () {
                        $("#tab-content-container").html('<p class="text-center">فشل تحميل المحتوى. حاول مرة أخرى لاحقاً.</p>');
                    }
                });
            }

            // Handle main tab clicks
            $("#default-tab button").on("click", function () {
                selectedTab = $(this).attr('id').replace('-tab', '');
                const url = $(this).data("content-url");
                loadTabContent(url, $('#transactionSearch').val(), $('#sortOrder').val());
                $("#default-tab button").removeClass("active-tab");
                $(this).addClass("active-tab");

                // Update the placeholder text
                $('#transactionSearch').attr('placeholder', placeholders[selectedTab]);
            });

            // Handle dropdown item clicks
            $('.dropdown-menu a').on('click', function (event) {
                event.preventDefault(); // Prevent default navigation
                const url = $(this).data("content-url");
                loadTabContent(url, $('#transactionSearch').val(), $('#sortOrder').val());
            });

            // Load initial content for the default tab
            $("#internal-tab").trigger("click");

            // Search functionality
            $('#transactionSearch').on('keyup', function () {
                const searchTerm = $(this).val().toLowerCase();
                $('#tab-content-container li').each(function () {
                    const text = $(this).text().toLowerCase();
                    $(this).toggle(text.includes(searchTerm));
                });
            });

            // Sorting functionality
            $('#sortOrder').on('change', function () {
                const sortOrder = $(this).val();
                const items = $('#tab-content-container ul > li').detach();

                items.sort((a, b) => {
                    const first = $(a).text().trim();
                    const second = $(b).text().trim();

                    return sortOrder === 'newest'
                        ? first.localeCompare(second) * -1
                        : first.localeCompare(second);
                });

                $('#tab-content-container ul').append(items);
            });
        });
        // Toggle dropdown visibility
        $('.arrow-down').on('click', function (event) {
            event.stopPropagation();
            $(this).siblings('.dropdown-menu').toggle(); // Toggle dropdown visibility
        });

        // Close the dropdown when clicking outside
        $(document).on('click', function () {
            $('.dropdown-menu').hide();
        });

        // Prevent closing the dropdown when clicking inside it
        $('.dropdown-menu').on('click', function (event) {
            event.stopPropagation();
        });

    </script>



</body>

</html>
