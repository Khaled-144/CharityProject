@model CharityProject.Models.Transaction

<div class="modal fade" id="insertTransactionModal" role="dialog">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header flex justify-center items-center">
				<button type="button" class="close text-danger close-button" data-dismiss="modal" aria-label="Close">
				</button>
				<button type="button" class="btn btn-danger" data-dismiss="modal">X</button>
				<h4 class="modal-title text-center w-full">إنشاء معاملة جديدة</h4>
			</div>
			<div class="modal-body align-content-center">
				<div class="col-md text-right" dir="rtl">
                    <form asp-action="Create_Transaction" method="post" enctype="multipart/form-data" id="transactionForm">
                        <div asp-validation-summary="ModelOnly" class="text-danger"></div>

                        <!-- Title -->
                        <div class="form-group mb-4">
                            <label asp-for="title" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">عنوان المعاملة</label>
                            <input asp-for="title" required class="form-control w-full border rounded focus:ring-blue-500 focus:border-blue-500" />
                            <span asp-validation-for="title" class="text-danger"></span>
                        </div>

                        <!-- Department -->
                        <div class="form-group mb-4">
                            <label asp-for="department_id"  class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">إلى</label>
                            <select asp-for="department_id" required asp-items="@(ViewData["Departments"] as IEnumerable<SelectListItem>)" class="form-control w-full border rounded focus:ring-blue-500 focus:border-blue-500">
                                <option disabled selected >-- أختر القسم --</option>
                            </select>
                            <span asp-validation-for="department_id" class="text-danger"></span>
                        </div>

                        <!-- Description -->
                        <div class="form-group mb-4">
                            <label asp-for="description" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">وصف المعاملة</label>
                            <input asp-for="description" class="form-control w-full border rounded focus:ring-blue-500 focus:border-blue-500" />
                            <span asp-validation-for="description" class="text-danger"></span>
                        </div>

                        <!-- Creation Date -->
                        <div class="form-group mb-4">
                            <label asp-for="create_date" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">تاريخ الانشاء</label>
                            <input asp-for="create_date" type="date" class="form-control w-full border rounded focus:ring-blue-500 focus:border-blue-500" id="myDateField" />
                        </div>

                        <!-- Files -->
                        <div class="form-group mb-4">
                            <label class="block mb-2 text-sm font-medium text-gray-900 dark:text-white" for="files">المرفقات</label>
                            <input name="files" class="form-control w-full border rounded focus:ring-blue-500 focus:border-blue-500"
                                   type="file" accept=".pdf,.xls,.xlsx,.doc,.docx" multiple id="fileInput" />
                            <span asp-validation-for="files" class="text-danger"></span>
                            <small id="fileError" class="text-danger" style="display:none;">الملفات المسموح بها فقط :PDF, Excel, Word</small>

                            <!-- Added container to display file names -->
                            <ul id="fileList" class="mt-2"></ul>
                        </div>


                        <!-- Confidentiality, Urgency, and Importance -->
                        <div class="flex justify-between space-x-4 mb-4 rtl:space-x-reverse">
                            <!-- Confidentiality -->
                            <div class="w-full">
                                <label class="block text-gray-700 font-bold mb-2">
                                    <i class="fas fa-lock"></i> سرية المعاملة
                                </label>
                                <div class="space-y-2">
                                    <label>
                                        <input type="radio" id="confidentiality_non_secret" name="confidentiality" value="غير سري" /> غير سري
                                    </label>
                                    <br />
                                    <label>
                                        <input type="radio" id="confidentiality_secret" name="confidentiality" value="سري" /> سري
                                    </label>

                                </div>
                            </div>

                            <!-- Urgency -->
                            <div class="w-full">
                                <label class="block text-gray-700 font-bold mb-2">
                                    <i class="fas fa-clock text-green-500"></i> أعجلية المعاملة
                                </label>
                                <div class="space-y-2">
                                    <label>
                                        <input type="radio" id="urgency_non_urgent" name="urgency" value="غير عاجلة" /> غير عاجلة
                                    </label><br />
                                    <label>
                                        <input type="radio" id="urgency_urgent" name="urgency" value="عاجلة" /> عاجلة
                                    </label><br />
                                    <label>
                                        <input type="radio" id="urgency_immediate" name="urgency" value="حالاً" /> حالاً
                                    </label>
                                </div>
                            </div>

                            <!-- Importance -->
                            <div class="w-full">
                                <label class="block text-gray-700 font-bold mb-2">
                                    <i class="fas fa-exclamation-circle text-red-500"></i> أهمية المعاملة
                                </label>
                                <div class="space-y-2">
                                    <label>
                                        <input type="radio" id="importance_normal" name="importance" value="عادي" /> عادي
                                    </label><br />
                                    <label>
                                        <input type="radio" id="importance_high" name="importance" value="هام" /> هام
                                    </label>
                                </div>
                            </div>
                        </div>


                        <!-- Submit Button -->
                        <div class="form-group flex justify-center mt-4">
                            <button class="bg-primaryButtons hover:bg-emerald-800 focus:ring-4 focus:outline-none focus:ring-emerald-300 dark:focus:ring-emerald-800 font-medium rounded-lg text-sm px-5 py-2.5 text-center me-2 mb-2 text-white font-bold py-2 px-4">رفع المعاملة</button>
                        </div>
                    </form>


				</div>
			</div>
		</div>
	</div>
</div>

<script>
	// Get today's date
	let today = new Date();

	// Format the date to YYYY-MM-DD (required by input type="date")
	let dd = String(today.getDate()).padStart(2, '0');
	let mm = String(today.getMonth() + 1).padStart(2, '0'); // January is 0!
	let yyyy = today.getFullYear();

	let formattedDate = yyyy + '-' + mm + '-' + dd;

	// Set the value of the date input field
	document.getElementById('myDateField').value = formattedDate;

    document.getElementById('transactionForm').addEventListener('submit', function (e) {
        var fileInput = document.getElementById('files');
        var allowedExtensions = /(\.pdf|\.xls|\.xlsx|\.doc|\.docx)$/i;
        var fileError = document.getElementById('fileError');
        fileError.style.display = 'none';

        if (fileInput.files.length > 0) {
            for (var i = 0; i < fileInput.files.length; i++) {
                var file = fileInput.files[i];
                if (!allowedExtensions.exec(file.name)) {
                    fileError.style.display = 'block';
                    e.preventDefault();
                    return;
                }
            }
        }
    });
    document.getElementById('fileInput').addEventListener('change', function () {
        var fileList = document.getElementById('fileList');
        fileList.innerHTML = ''; // Clear the list first

        for (var i = 0; i < this.files.length; i++) {
            var listItem = document.createElement('li');
            listItem.textContent = this.files[i].name; // Add file name
            fileList.appendChild(listItem);
        }
    });
</script>

@section Scripts {
	@{
		await Html.RenderPartialAsync("_ValidationScriptsPartial");
	}
}
