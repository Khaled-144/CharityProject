@model CharityProject.Models.Transaction

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>معاملة جديدة</title>

    <!-- Stylesheets -->
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet">

    <!-- Scripts -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

    <style>
        .warning {
            color: red;
            display: none;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <div class="modal fade" id="insertTransactionModal" role="dialog">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <!-- Modal Header -->
                <div class="modal-header flex justify-between items-center">
                    <button type="button" class="btn btn-danger" data-dismiss="modal">X</button>
                    <h4 class="modal-title w-full font-bold text-center">إنشاء معاملة جديدة</h4>
                </div>

                <!-- Modal Body -->
                <div class="modal-body">
                    <div class="col-md text-right" dir="rtl">
                        <form id="transactionForm" asp-action="Create_Transaction" method="post" enctype="multipart/form-data">
                            <div asp-validation-summary="ModelOnly" class="text-danger"></div>

                            <!-- Title -->
                            <div class="mb-3">
                                <label asp-for="title" class="block text-sm font-medium font-bold text-gray-700">عنوان المعاملة</label>
                                <input asp-for="title" required type="text" id="title" name="title" 
                                       class="mt-1 p-2 w-full border rounded-md focus:ring-blue-500 focus:border-blue-500"
                                       maxlength="255"
                                       oninput="updateTitleCharacterCount()">
                                <div id="titleCharCount" class="text-gray-500">عدد الأحرف المتبقية: 255</div>
                            </div>

                            <!-- Department Select -->
                            <div id="dropdownContainer" class="dropdown-container flex flex-col md:flex-row gap-4">
                                <!-- Department Select -->
                                <div id="departmentDropdownContainer" class="relative flex-1">
                                    <label for="departmentSelect" class="block font-bold text-gray-700 mb-1">القسم</label>
                                    <select asp-for="department_id" name="department_id" id="departmentSelect" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                        <option value="" disabled selected>--اختر القسم--</option>
                                        @foreach (var item in ViewData["Departments"] as IEnumerable<SelectListItem>)
                                        {
                                            <option value="@item.Value">@item.Text</option>
                                        }
                                    </select>
                                    <div id="departmentWarning" class="warning">الرجاء اختيار قسم واحد</div>
                                </div>
                            </div>

                            <!-- Description -->
                            <div class="mb-3">
                                <label asp-for="description" class="block text-sm font-bold text-gray-700">وصف المعاملة</label>
                                <textarea asp-for="description" id="description" name="description" 
                                          class="mt-1 p-2 w-full border rounded-md focus:ring-blue-500 focus:border-blue-500"
                                          maxlength="1000"
                                          oninput="updateCharacterCount()"></textarea>
                                <div id="charCount" class="text-gray-500">عدد الأحرف المتبقية: 1000</div>
                            </div>

                            <!-- Files --> <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-3">
                                
                                   
                                        <div>
                                            <label class="block mb-2 text-sm font-medium text-gray-900 dark:text-white" for="files">المرفقات</label>
                                            <input name="files" class="form-control w-full border rounded focus:ring-blue-500 focus:border-blue-500"
                                                   type="file" accept=".pdf,.xls,.xlsx,.doc,.docx" multiple id="fileInput" />
                                            <span asp-validation-for="files" class="text-danger"></span>
                                            <small id="fileError" class="text-danger" style="display:none;">الملفات المسموح بها فقط :PDF, Excel, Word</small>

                                            <!-- Added container to display file names -->
                                            <ul id="fileList"></ul>
                                   </div>
                                <div>
                                    <label asp-for="create_date" class="block text-sm font-bold text-gray-700 text-right">تاريخ الإنشاء</label>
                                    <input type="date" asp-for="create_date" id="create_date" name="create_date" class=" w-full  border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                </div>
                            </div>
          

                            <!-- Confidentiality, Urgency, Importance -->
                            <div class="flex justify-between">
                                <div class="mb-4">
                                    <label for="Confidentiality" class="block text-gray-700 font-bold mb-2">
                                        <i class="fas fa-lock"></i> سرية المعاملة
                                    </label>
                                    <input type="radio" asp-for="Confidentiality" name="Confidentiality" value="سري" /> سري <br />
                                    <input type="radio" asp-for="Confidentiality" name="Confidentiality" value="غير سري" /> غير سري
                                </div>
                                <div class="mb-4">
                                    <label for="Urgency" class="block text-gray-700 font-bold mb-2">
                                        <i class="fas fa-clock text-green-500"></i> أعجلية المعاملة
                                    </label>
                                    <input type="radio" asp-for="Urgency" name="Urgency" value="غير عاجلة" /> غير عاجلة <br />
                                    <input type="radio" asp-for="Urgency" name="Urgency" value="عاجلة" /> عاجلة <br />
                                    <input type="radio" asp-for="Urgency" name="Urgency" value="حالاً" /> حالاً
                                </div>
                                <div class="mb-4">
                                    <label for="Importance" class="block text-gray-700 font-bold mb-2">
                                        <i class="fas fa-exclamation-circle text-red-500"></i> أهمية المعاملة
                                    </label>
                                    <input type="radio" asp-for="Importance" name="Importance" value="عادي" /> عادي <br />
                                    <input type="radio" asp-for="Importance" name="Importance" value="هام" /> هام
                                </div>
                            </div>

                            <!-- Submit Button -->
                            <div class="flex justify-center">
                                <button type="submit" class="bg-gradient-to-r from-green-400 via-green-500 to-green-600 hover:bg-gradient-to-br focus:ring-4 focus:outline-none focus:ring-green-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center text-white">رفع المعاملة</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Set today's date
        document.addEventListener('DOMContentLoaded', function () {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('create_date').value = today;

            // Add form submission validation
            document.getElementById('transactionForm').addEventListener('submit', function (event) {
                const selectedDepartment = document.getElementById('departmentSelect').value;
                let valid = true;

                // Reset warnings
                document.getElementById('departmentWarning').style.display = 'none';

                // If no department is chosen
                if (!selectedDepartment) {
                    document.getElementById('departmentWarning').textContent = 'الرجاء اختيار قسم واحد';
                    document.getElementById('departmentWarning').style.display = 'block';
                    valid = false;
                }

                // Prevent form submission if validation fails
                if (!valid) {
                    event.preventDefault();
                }
            });
        });

        // Add new function for title counter
        const maxTitleChars = 255;
        
        function updateTitleCharacterCount() {
            const titleField = document.getElementById('title');
            const titleCharCount = document.getElementById('titleCharCount');
            const currentLength = titleField.value.length;
            const remainingChars = maxTitleChars - currentLength;

            titleCharCount.textContent = `عدد الأحرف المتبقية: ${remainingChars}`;
            titleCharCount.style.color = remainingChars < 0 ? 'red' : '#6b7280';
        }

        // Initialize character counter when page loads
        document.addEventListener('DOMContentLoaded', function() {
            updateCharacterCount(); // Initial update
            
            // Add input event listener
            document.getElementById('description').addEventListener('input', updateCharacterCount);
        });

        const maxdescriptionChars = 1000;

        function updateCharacterCount() {
            const descriptionField = document.getElementById('description');
            const charCountDisplay = document.getElementById('charCount');
            const currentLength = descriptionField.value.length;
            const remainingChars = maxdescriptionChars - currentLength;

            // Update display and color
            charCountDisplay.textContent = `عدد الأحرف المتبقية: ${remainingChars}`;
            charCountDisplay.style.color = remainingChars < 0 ? 'red' : '#6b7280'; // Gray color
        }

        // File input handling
        document.getElementById('fileInput').addEventListener('change', function () {
            var fileList = document.getElementById('fileList');
            fileList.innerHTML = ''; // Clear the list first

            for (var i = 0; i < this.files.length; i++) {
                var listItem = document.createElement('li');
                listItem.textContent = this.files[i].name; // Add file name
                fileList.appendChild(listItem);
            }
        });
    </script>
</body>
</html>
@section Scripts {
	@{
		await Html.RenderPartialAsync("_ValidationScriptsPartial");
	}
}
